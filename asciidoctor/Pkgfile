# Description: text processor & publishing toolchain for AsciiDoc documents
# URL: https://asciidoctor.org/
# Maintainer: Cory Burgett, cmburget at gmail dot com
# Depends on: ruby

name=asciidoctor
version=2.0.10
release=1
source=(https://github.com/asciidoctor/$name/archive/v$version/$name-$version.tar.gz)

build () {
	cd $name-$version

	local gemdir=`ruby -e 'puts Gem.default_dir'`
	gemdir=${gemdir#/}

	gem build --verbose ./$name.gemspec

	gem install $name \
		--verbose \
		--local \
		--ignore-dependencies \
		--no-user-install \
		--no-document \
		--build-root $PKG

	install -D -m644 -t $PKG/usr/share/man/man1/ \
	                    $PKG/$gemdir/gems/$name-$version/man/$name.1

	rm -rf $PKG/$gemdir/cache
	rm -rf $PKG/$gemdir/gems/$name-$version/man
	find $PKG -type f -name '*.adoc' -exec rm -f {} \;
}
